<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìö Dashboard - Concurso C√¢mara dos Deputados 2026</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    <style>
:root {
    --bg-primary: #f0f4f8;
    --bg-white: #ffffff;
    --border-color: #d1d9e6;
    --text-primary: #1a202c;
    --text-secondary: #4a5568;
    --text-muted: #718096;
    --accent-blue: #3182ce;
    --accent-green: #38a169;
    --accent-orange: #dd6b20;
    --accent-purple: #805ad5;
    --accent-red: #e53e3e;
    --accent-teal: #319795;
    --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
    --shadow-md: 0 4px 6px rgba(0,0,0,0.07);
    --shadow-lg: 0 10px 15px rgba(0,0,0,0.1);
    --radius-sm: 6px;
    --radius-md: 10px;
    --radius-lg: 16px;
}
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: 'Inter', -apple-system, sans-serif; background: var(--bg-primary); color: var(--text-primary); min-height: 100vh; line-height: 1.6; }

/* LOGIN */
.login-screen { min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
.login-container { background: var(--bg-white); border-radius: var(--radius-lg); padding: 40px; width: 100%; max-width: 420px; box-shadow: var(--shadow-lg); }
.login-header { text-align: center; margin-bottom: 32px; }
.login-header .emoji { font-size: 3rem; margin-bottom: 16px; }
.login-header h1 { font-size: 1.5rem; font-weight: 700; margin-bottom: 8px; color: var(--text-primary); }
.login-header p { color: var(--text-muted); font-size: 0.95rem; }
.form-group { margin-bottom: 20px; }
.form-group label { display: block; font-size: 0.875rem; font-weight: 600; margin-bottom: 8px; color: var(--text-secondary); }
.form-group input { width: 100%; padding: 14px 16px; border: 2px solid var(--border-color); border-radius: var(--radius-sm); font-size: 1rem; transition: all 0.2s; outline: none; }
.form-group input:focus { border-color: var(--accent-blue); box-shadow: 0 0 0 3px rgba(49, 130, 206, 0.1); }
.btn { display: inline-flex; align-items: center; justify-content: center; gap: 8px; padding: 14px 28px; border: 2px solid transparent; border-radius: var(--radius-sm); font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.2s; text-decoration: none; }
.btn-primary { background: var(--accent-blue); border-color: var(--accent-blue); color: white; }
.btn-primary:hover { background: #2c5282; border-color: #2c5282; transform: translateY(-1px); }
.btn-outline { background: transparent; border-color: var(--border-color); color: var(--text-secondary); }
.btn-outline:hover { border-color: var(--accent-blue); color: var(--accent-blue); }
.btn-success { background: var(--accent-green); border-color: var(--accent-green); color: white; }
.btn-success:hover { background: #2f855a; }
.btn-full { width: 100%; }
.btn-sm { padding: 8px 16px; font-size: 0.875rem; }
.btn-icon { width: 44px; height: 44px; padding: 0; border-radius: 50%; }
.login-error { background: #fed7d7; border: 1px solid var(--accent-red); color: #c53030; padding: 12px 16px; border-radius: var(--radius-sm); font-size: 0.875rem; margin-bottom: 20px; display: none; text-align: center; }

/* APP */
.app-container { display: none; min-height: 100vh; }
.app-container.active { display: block; }

/* HEADER */
.header { background: var(--bg-white); border-bottom: 2px solid var(--border-color); padding: 16px 24px; position: sticky; top: 0; z-index: 100; }
.header-content { max-width: 1400px; margin: 0 auto; display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 16px; }
.header-left { display: flex; align-items: center; gap: 20px; }
.logo { font-size: 1.25rem; font-weight: 700; display: flex; align-items: center; gap: 10px; }
.logo-icon { font-size: 1.5rem; }
.user-badge { display: flex; align-items: center; gap: 8px; padding: 8px 16px; background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%); border-radius: 24px; color: white; font-size: 0.875rem; font-weight: 500; }
.header-right { display: flex; align-items: center; gap: 12px; flex-wrap: wrap; }
.countdown { display: flex; align-items: center; gap: 10px; padding: 10px 20px; background: var(--bg-primary); border: 2px solid var(--accent-orange); border-radius: var(--radius-sm); }
.countdown-number { font-size: 1.25rem; font-weight: 700; color: var(--accent-orange); }
.countdown-label { font-size: 0.875rem; color: var(--text-secondary); }

/* MAIN */
.main-content { max-width: 1400px; margin: 0 auto; padding: 24px; }

/* STATS */
.stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; margin-bottom: 28px; }
.stat-card { background: var(--bg-white); border: 2px solid var(--border-color); border-radius: var(--radius-md); padding: 24px; transition: all 0.2s; position: relative; overflow: hidden; }
.stat-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; }
.stat-card:nth-child(1)::before { background: var(--accent-blue); }
.stat-card:nth-child(2)::before { background: var(--accent-purple); }
.stat-card:nth-child(3)::before { background: var(--accent-teal); }
.stat-card:nth-child(4)::before { background: var(--accent-orange); }
.stat-card:hover { border-color: var(--accent-blue); transform: translateY(-2px); box-shadow: var(--shadow-md); }
.stat-card h3 { font-size: 0.75rem; font-weight: 600; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; }
.stat-card .value { font-size: 2.25rem; font-weight: 700; line-height: 1.2; }
.stat-card .subtitle { font-size: 0.875rem; color: var(--text-secondary); margin-top: 4px; }

/* DATE SELECTOR */
.controls-row { display: flex; gap: 16px; margin-bottom: 24px; flex-wrap: wrap; }
.date-selector { background: var(--bg-white); border: 2px solid var(--border-color); border-radius: var(--radius-md); padding: 20px; display: flex; align-items: center; gap: 16px; flex: 1; min-width: 300px; }
.date-selector label { font-weight: 600; color: var(--text-secondary); white-space: nowrap; }
.date-selector input[type="date"] { padding: 10px 14px; border: 2px solid var(--border-color); border-radius: var(--radius-sm); font-size: 1rem; outline: none; flex: 1; min-width: 150px; }
.date-selector input:focus { border-color: var(--accent-blue); }

/* SEARCH */
.search-container { background: var(--bg-white); border: 2px solid var(--border-color); border-radius: var(--radius-md); padding: 20px; margin-bottom: 24px; }
.search-box { position: relative; }
.search-box input { width: 100%; padding: 14px 16px 14px 48px; border: 2px solid var(--border-color); border-radius: var(--radius-sm); font-size: 1rem; outline: none; transition: all 0.2s; }
.search-box input:focus { border-color: var(--accent-blue); box-shadow: 0 0 0 3px rgba(49, 130, 206, 0.1); }
.search-box i { position: absolute; left: 16px; top: 50%; transform: translateY(-50%); color: var(--text-muted); font-size: 1.25rem; }
.search-results { margin-top: 12px; border: 2px solid var(--border-color); border-radius: var(--radius-sm); max-height: 320px; overflow-y: auto; display: none; }
.search-results.active { display: block; }
.search-result-item { padding: 14px 16px; border-bottom: 1px solid var(--border-color); cursor: pointer; transition: background 0.15s; }
.search-result-item:hover { background: var(--bg-primary); }
.search-result-item:last-child { border-bottom: none; }
.search-result-item .discipline { font-size: 0.7rem; font-weight: 600; color: var(--accent-purple); text-transform: uppercase; letter-spacing: 0.5px; }
.search-result-item .topic { font-weight: 500; margin-top: 4px; color: var(--text-primary); }

/* TABS */
.tabs { display: flex; gap: 8px; margin-bottom: 24px; flex-wrap: wrap; }
.tab { padding: 12px 24px; border: 2px solid var(--border-color); border-radius: var(--radius-sm); background: var(--bg-white); cursor: pointer; font-weight: 600; transition: all 0.2s; display: flex; align-items: center; gap: 8px; }
.tab:hover { border-color: var(--accent-blue); color: var(--accent-blue); }
.tab.active { border-color: var(--accent-blue); background: var(--accent-blue); color: white; }

/* DISCIPLINES */
.disciplines-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(380px, 1fr)); gap: 24px; }
.discipline-card { background: var(--bg-white); border: 2px solid var(--border-color); border-radius: var(--radius-md); overflow: hidden; transition: all 0.2s; }
.discipline-card:hover { border-color: var(--accent-blue); box-shadow: var(--shadow-md); }
.discipline-header { padding: 20px; border-bottom: 1px solid var(--border-color); cursor: pointer; display: flex; align-items: center; justify-content: space-between; background: linear-gradient(to right, rgba(49, 130, 206, 0.03), transparent); }
.discipline-header h3 { font-size: 1rem; font-weight: 700; color: var(--text-primary); }
.discipline-header .count { font-size: 0.8rem; color: var(--text-muted); background: var(--bg-primary); padding: 4px 12px; border-radius: 12px; }
.progress-bars { padding: 16px 20px; display: flex; gap: 16px; background: var(--bg-primary); }
.progress-item { flex: 1; }
.progress-item .label { font-size: 0.75rem; font-weight: 600; margin-bottom: 6px; display: flex; justify-content: space-between; }
.progress-item .label .name { text-transform: uppercase; letter-spacing: 0.3px; }
.progress-item .label .name.kathiaja { color: var(--accent-purple); }
.progress-item .label .name.bruno { color: var(--accent-blue); }
.progress-bar { height: 8px; background: var(--bg-white); border-radius: 4px; overflow: hidden; border: 1px solid var(--border-color); }
.progress-fill { height: 100%; border-radius: 4px; transition: width 0.4s ease; }
.progress-fill.kathiaja { background: linear-gradient(90deg, var(--accent-purple), #9f7aea); }
.progress-fill.bruno { background: linear-gradient(90deg, var(--accent-blue), #63b3ed); }
.discipline-content { display: none; max-height: 450px; overflow-y: auto; }
.discipline-content.expanded { display: block; }
.topic-item { padding: 16px 20px; border-bottom: 1px solid var(--border-color); display: flex; align-items: flex-start; gap: 16px; transition: background 0.15s; }
.topic-item:hover { background: rgba(49, 130, 206, 0.02); }
.topic-item:last-child { border-bottom: none; }
.topic-checkboxes { display: flex; flex-direction: column; gap: 6px; min-width: 70px; }
.checkbox-row { display: flex; align-items: center; gap: 8px; }
.checkbox-row input[type="checkbox"] { width: 18px; height: 18px; cursor: pointer; accent-color: var(--accent-green); }
.checkbox-row .user-initial { width: 22px; height: 22px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.7rem; font-weight: 700; color: white; }
.checkbox-row .user-initial.kathiaja { background: var(--accent-purple); }
.checkbox-row .user-initial.bruno { background: var(--accent-blue); }
.topic-info { flex: 1; cursor: pointer; }
.topic-title { font-weight: 500; color: var(--text-primary); line-height: 1.4; }
.topic-status { display: flex; gap: 16px; margin-top: 8px; }
.status-badge { font-size: 0.75rem; padding: 3px 10px; border-radius: 12px; font-weight: 500; }
.status-badge.done { background: #c6f6d5; color: #22543d; }
.status-badge.pending { background: #feebc8; color: #744210; }

/* TIMELINE */
.timeline-container { background: var(--bg-white); border: 2px solid var(--border-color); border-radius: var(--radius-md); padding: 24px; }
.timeline-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 12px; }
.timeline-header h2 { font-size: 1.25rem; font-weight: 700; display: flex; align-items: center; gap: 10px; }
.timeline-scroll { overflow-x: auto; padding-bottom: 16px; }
.timeline { display: flex; gap: 16px; min-width: max-content; }
.timeline-day { min-width: 200px; background: var(--bg-primary); border: 2px solid var(--border-color); border-radius: var(--radius-sm); overflow: hidden; transition: all 0.2s; }
.timeline-day:hover { border-color: var(--accent-blue); }
.timeline-day.today { border-color: var(--accent-blue); box-shadow: 0 0 0 3px rgba(49, 130, 206, 0.2); }
.timeline-day.past { opacity: 0.6; }
.timeline-day-header { padding: 12px 16px; background: var(--bg-white); border-bottom: 1px solid var(--border-color); font-weight: 700; font-size: 0.9rem; }
.timeline-day.today .timeline-day-header { background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple)); color: white; }
.timeline-day-content { padding: 12px; max-height: 220px; overflow-y: auto; }
.timeline-topic { padding: 10px 12px; background: var(--bg-white); border: 1px solid var(--border-color); border-radius: 6px; margin-bottom: 8px; cursor: pointer; transition: all 0.15s; }
.timeline-topic:hover { border-color: var(--accent-blue); transform: translateX(2px); }
.timeline-topic:last-child { margin-bottom: 0; }
.timeline-topic .discipline { font-size: 0.65rem; font-weight: 600; color: var(--accent-purple); text-transform: uppercase; letter-spacing: 0.3px; }
.timeline-topic .title { font-size: 0.8rem; margin-top: 4px; color: var(--text-primary); }
.timeline-topic.completed { background: #f0fff4; border-color: var(--accent-green); }
.timeline-topic.completed .title { color: var(--accent-green); }

/* EVENTS */
.event-card { display: flex; align-items: center; gap: 20px; padding: 20px; background: var(--bg-white); border: 2px solid var(--border-color); border-radius: var(--radius-sm); margin-bottom: 16px; transition: all 0.2s; }
.event-card:hover { border-color: var(--accent-blue); }
.event-card.past { opacity: 0.5; }
.event-card.soon { border-color: var(--accent-orange); background: #fffaf0; }
.event-date { min-width: 70px; text-align: center; padding: 12px; background: var(--bg-primary); border-radius: var(--radius-sm); }
.event-date .day { font-size: 1.75rem; font-weight: 700; color: var(--accent-blue); line-height: 1; }
.event-date .month { font-size: 0.75rem; font-weight: 600; color: var(--text-muted); text-transform: uppercase; margin-top: 4px; }
.event-info { flex: 1; }
.event-info .title { font-weight: 700; font-size: 1rem; margin-bottom: 4px; }
.event-info .desc { font-size: 0.875rem; color: var(--text-muted); }
.event-countdown { padding: 8px 16px; border-radius: 20px; font-size: 0.8rem; font-weight: 600; }
.event-countdown.passed { background: #e2e8f0; color: var(--text-muted); }
.event-countdown.soon { background: #fed7d7; color: #c53030; }
.event-countdown.normal { background: #c6f6d5; color: #22543d; }

/* MODAL */
.modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.6); display: flex; align-items: center; justify-content: center; z-index: 1000; opacity: 0; visibility: hidden; transition: all 0.25s; padding: 20px; }
.modal-overlay.active { opacity: 1; visibility: visible; }
.modal { background: var(--bg-white); border-radius: var(--radius-lg); width: 100%; max-width: 640px; max-height: 85vh; overflow: hidden; display: flex; flex-direction: column; transform: translateY(20px); transition: transform 0.25s; }
.modal-overlay.active .modal { transform: translateY(0); }
.modal-header { padding: 24px; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: flex-start; gap: 16px; }
.modal-header h2 { font-size: 1.1rem; font-weight: 700; line-height: 1.4; }
.modal-close { width: 36px; height: 36px; border: none; background: var(--bg-primary); cursor: pointer; font-size: 1.25rem; color: var(--text-muted); border-radius: 50%; transition: all 0.2s; flex-shrink: 0; }
.modal-close:hover { background: var(--accent-red); color: white; }
.modal-body { padding: 24px; overflow-y: auto; flex: 1; }
.modal-discipline { color: var(--accent-purple); font-size: 0.8rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 20px; }
.progress-section { background: var(--bg-primary); padding: 20px; border-radius: var(--radius-sm); margin-bottom: 24px; }
.progress-section h4 { font-size: 0.875rem; font-weight: 700; margin-bottom: 16px; color: var(--text-secondary); }
.progress-checkboxes { display: flex; gap: 32px; flex-wrap: wrap; }
.progress-checkbox { display: flex; align-items: center; gap: 10px; cursor: pointer; }
.progress-checkbox input { width: 20px; height: 20px; accent-color: var(--accent-green); }
.progress-checkbox span { font-weight: 500; }

/* LINKS */
.links-section { margin-top: 24px; }
.links-section h4 { font-size: 0.875rem; font-weight: 700; margin-bottom: 16px; color: var(--text-secondary); display: flex; align-items: center; gap: 8px; }
.links-tabs { display: flex; gap: 8px; margin-bottom: 16px; }
.links-tab { padding: 8px 16px; border: 2px solid var(--border-color); border-radius: 20px; font-size: 0.8rem; font-weight: 600; cursor: pointer; background: var(--bg-white); transition: all 0.2s; }
.links-tab:hover { border-color: var(--accent-blue); }
.links-tab.active { background: var(--accent-blue); border-color: var(--accent-blue); color: white; }
.links-list { min-height: 60px; }
.link-item { display: flex; align-items: center; gap: 12px; padding: 14px; background: var(--bg-primary); border-radius: var(--radius-sm); margin-bottom: 10px; }
.link-item i { color: var(--accent-blue); font-size: 1.1rem; }
.link-item a { color: var(--accent-blue); text-decoration: none; flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; font-weight: 500; }
.link-item a:hover { text-decoration: underline; }
.link-item .by { font-size: 0.75rem; color: var(--text-muted); }
.link-item .delete { color: var(--accent-red); cursor: pointer; padding: 4px; }
.link-item .delete:hover { background: #fed7d7; border-radius: 4px; }
.add-link-form { display: flex; gap: 10px; margin-top: 16px; }
.add-link-form input { flex: 1; padding: 12px 16px; border: 2px solid var(--border-color); border-radius: var(--radius-sm); font-size: 0.9rem; }
.add-link-form input:focus { outline: none; border-color: var(--accent-blue); }
.no-links { color: var(--text-muted); font-size: 0.9rem; padding: 20px; text-align: center; background: var(--bg-primary); border-radius: var(--radius-sm); }
.modal-footer { padding: 20px 24px; border-top: 1px solid var(--border-color); display: flex; justify-content: flex-end; gap: 12px; background: var(--bg-primary); }

/* LOADING & TOAST */
.loading-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(240, 244, 248, 0.95); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 2000; }
.loading-overlay.hidden { display: none; }
.spinner { width: 48px; height: 48px; border: 4px solid var(--border-color); border-top-color: var(--accent-blue); border-radius: 50%; animation: spin 0.8s linear infinite; }
@keyframes spin { to { transform: rotate(360deg); } }
.loading-text { margin-top: 20px; color: var(--text-secondary); font-weight: 500; }

.toast-container { position: fixed; bottom: 24px; right: 24px; z-index: 3000; }
.toast { background: var(--bg-white); border: 2px solid var(--border-color); border-radius: var(--radius-sm); padding: 16px 24px; margin-top: 12px; box-shadow: var(--shadow-lg); display: flex; align-items: center; gap: 12px; animation: slideIn 0.3s ease; font-weight: 500; }
.toast.success { border-color: var(--accent-green); }
.toast.success i { color: var(--accent-green); }
.toast.error { border-color: var(--accent-red); }
.toast.error i { color: var(--accent-red); }
@keyframes slideIn { from { transform: translateX(120%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

/* RESPONSIVE */
@media (max-width: 768px) {
    .header-content { flex-direction: column; align-items: stretch; }
    .header-left, .header-right { justify-content: center; }
    .stats-grid { grid-template-columns: repeat(2, 1fr); }
    .disciplines-grid { grid-template-columns: 1fr; }
    .controls-row { flex-direction: column; }
    .date-selector { min-width: auto; }
    .modal { max-height: 90vh; }
}
    </style>
</head>
<body>
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
        <div class="loading-text">Carregando dashboard...</div>
    </div>

    <div class="login-screen" id="loginScreen">
        <div class="login-container">
            <div class="login-header">
                <div class="emoji">üìö</div>
                <h1>Dashboard de Estudos</h1>
                <p>Concurso C√¢mara dos Deputados 2026</p>
            </div>
            <div class="login-error" id="loginError">
                <i class="ri-error-warning-line"></i> Usu√°rio ou senha incorretos
            </div>
            <form id="loginForm">
                <div class="form-group">
                    <label for="username">Usu√°rio</label>
                    <input type="text" id="username" placeholder="Digite seu usu√°rio" autocomplete="username" required>
                </div>
                <div class="form-group">
                    <label for="password">Senha</label>
                    <input type="password" id="password" placeholder="Digite sua senha" autocomplete="current-password" required>
                </div>
                <button type="submit" class="btn btn-primary btn-full">
                    <i class="ri-login-box-line"></i> Entrar
                </button>
            </form>
        </div>
    </div>

    <div class="app-container" id="appContainer">
        <header class="header">
            <div class="header-content">
                <div class="header-left">
                    <div class="logo">
                        <span class="logo-icon">üìö</span>
                        <span>C√¢mara dos Deputados</span>
                    </div>
                    <div class="user-badge">
                        <i class="ri-user-line"></i>
                        <span id="currentUserName">-</span>
                    </div>
                </div>
                <div class="header-right">
                    <div class="countdown">
                        <i class="ri-calendar-event-line" style="color: var(--accent-orange);"></i>
                        <div>
                            <div class="countdown-number" id="daysRemaining">-</div>
                            <div class="countdown-label">dias para a prova</div>
                        </div>
                    </div>
                    <button class="btn btn-outline btn-icon" onclick="reloadData()" title="Recarregar">
                        <i class="ri-refresh-line"></i>
                    </button>
                    <button class="btn btn-outline btn-icon" onclick="logout()" title="Sair">
                        <i class="ri-logout-box-line"></i>
                    </button>
                </div>
            </div>
        </header>

        <main class="main-content">
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>Total de Mat√©rias</h3>
                    <div class="value" id="totalTopics">-</div>
                    <div class="subtitle">em <span id="totalDisciplines">-</span> disciplinas</div>
                </div>
                <div class="stat-card">
                    <h3>Seu Progresso</h3>
                    <div class="value" id="userProgress">-</div>
                    <div class="subtitle">mat√©rias conclu√≠das</div>
                </div>
                <div class="stat-card">
                    <h3>Progresso do Parceiro</h3>
                    <div class="value" id="partnerProgress">-</div>
                    <div class="subtitle">mat√©rias conclu√≠das</div>
                </div>
                <div class="stat-card">
                    <h3>Meta Di√°ria</h3>
                    <div class="value" id="dailyGoal">-</div>
                    <div class="subtitle">mat√©rias por dia</div>
                </div>
            </div>

            <div class="controls-row">
                <div class="date-selector">
                    <label><i class="ri-calendar-line"></i> Data limite:</label>
                    <input type="date" id="targetDate" onchange="updateTargetDate()">
                    <button class="btn btn-primary btn-sm" onclick="redistributeStudies()">
                        <i class="ri-refresh-line"></i> Redistribuir
                    </button>
                </div>
            </div>

            <div class="search-container">
                <div class="search-box">
                    <i class="ri-search-line"></i>
                    <input type="text" id="searchInput" placeholder="Buscar mat√©ria ou disciplina..." oninput="handleSearch()">
                </div>
                <div class="search-results" id="searchResults"></div>
            </div>

            <div class="tabs">
                <div class="tab active" data-tab="disciplines" onclick="switchTab('disciplines')">
                    <i class="ri-book-2-line"></i> Disciplinas
                </div>
                <div class="tab" data-tab="timeline" onclick="switchTab('timeline')">
                    <i class="ri-calendar-line"></i> Cronograma
                </div>
                <div class="tab" data-tab="events" onclick="switchTab('events')">
                    <i class="ri-flag-line"></i> Datas Importantes
                </div>
            </div>

            <div id="disciplinesTab" class="tab-content">
                <div class="disciplines-grid" id="disciplinesGrid"></div>
            </div>

            <div id="timelineTab" class="tab-content" style="display: none;">
                <div class="timeline-container">
                    <div class="timeline-header">
                        <h2><i class="ri-calendar-todo-line"></i> Cronograma de Estudos</h2>
                        <button class="btn btn-primary btn-sm" onclick="scrollToToday()">
                            <i class="ri-focus-3-line"></i> Ir para Hoje
                        </button>
                    </div>
                    <div class="timeline-scroll">
                        <div class="timeline" id="timeline"></div>
                    </div>
                </div>
            </div>

            <div id="eventsTab" class="tab-content" style="display: none;">
                <div class="timeline-container">
                    <div class="timeline-header">
                        <h2><i class="ri-flag-2-line"></i> Datas Importantes do Concurso</h2>
                    </div>
                    <div id="eventsGrid"></div>
                </div>
            </div>
        </main>
    </div>

    <div class="modal-overlay" id="topicModal">
        <div class="modal">
            <div class="modal-header">
                <h2 id="modalTitle">Detalhes da Mat√©ria</h2>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="modal-discipline" id="modalDiscipline"></div>
                
                <div class="progress-section">
                    <h4><i class="ri-checkbox-circle-line"></i> Seu Progresso</h4>
                    <div class="progress-checkboxes">
                        <label class="progress-checkbox">
                            <input type="checkbox" id="modalTheory" onchange="updateTopicProgress()">
                            <span>üìñ Teoria conclu√≠da</span>
                        </label>
                        <label class="progress-checkbox">
                            <input type="checkbox" id="modalPractice" onchange="updateTopicProgress()">
                            <span>‚úèÔ∏è Pr√°tica conclu√≠da</span>
                        </label>
                    </div>
                </div>
                
                <div class="links-section">
                    <h4><i class="ri-link"></i> Links de Estudo</h4>
                    <div class="links-tabs">
                        <div class="links-tab active" data-type="theory" onclick="switchLinksTab('theory')">üìñ Te√≥ricos</div>
                        <div class="links-tab" data-type="practice" onclick="switchLinksTab('practice')">‚úèÔ∏è Pr√°ticos</div>
                    </div>
                    <div class="links-list" id="linksList"></div>
                    <div class="add-link-form">
                        <input type="url" id="newLinkUrl" placeholder="Cole o link aqui...">
                        <button class="btn btn-success btn-sm" onclick="addLink()">
                            <i class="ri-add-line"></i> Adicionar
                        </button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal()">Fechar</button>
                <button class="btn btn-success" onclick="saveTopicChanges()">
                    <i class="ri-save-line"></i> Salvar Altera√ß√µes
                </button>
            </div>
        </div>
    </div>

    <div class="toast-container" id="toastContainer"></div>

    <script>
const CONFIG = {
    GOOGLE_SHEETS_ID: '1dn2El552q5fj5qdA_PD7kFlUs2aTjOEpxGofyi8CeyA',
    GOOGLE_API_KEY: '633808003658-12ue6v9brrlcmpi7db2prv7tmsnj8j6h.apps.googleusercontent.com',
    DATA_PROVA: '2026-03-08',
    USUARIOS: {"kathiaja": {"nome": "Kathiaja Miranda Souza", "senha_hash": "410d84384d69069f464df4611cdc8db4ae552bc1cdfd289756f7085866cbc64a"}, "bruno": {"nome": "Bruno de Lima e Souza", "senha_hash": "90b832a23561f4822f8f7b66616d569c667b1098905603953ff709a7c3cfb657"}}
};

const CONTEUDO = {"L√çNGUA PORTUGUESA": ["1. Compreens√£o e interpreta√ß√£o de textos de g√™neros variados", "2. Reconhecimento de tipos e g√™neros textuais", "3. Dom√≠nio da ortografia", "4. Dom√≠nio dos mecanismos de coes√£o textual", "4.1 Emprego de elementos de referencia√ß√£o, substitui√ß√£o e repeti√ß√£o, de conectores e outros elementos de sequencia√ß√£o textual", "4.2 Emprego de tempos e modos verbais", "5. Dom√≠nio da estrutura morfossint√°tica do per√≠odo", "5.1 Emprego das classes de palavras", "5.2 Rela√ß√µes de coordena√ß√£o entre ora√ß√µes e entre termos da ora√ß√£o", "5.3 Rela√ß√µes de subordina√ß√£o entre ora√ß√µes e entre termos da ora√ß√£o", "5.4 Emprego dos sinais de pontua√ß√£o", "5.5 Concord√¢ncia verbal e nominal", "5.6 Reg√™ncia verbal e nominal", "5.7 Emprego do sinal indicativo de crase", "5.8 Coloca√ß√£o dos pronomes √°tonos", "6. Reescrita de frases e par√°grafos do texto", "6.1 Significa√ß√£o das palavras", "6.2 Substitui√ß√£o de palavras ou de trechos de texto", "6.3 Reorganiza√ß√£o da estrutura de ora√ß√µes e de per√≠odos do texto", "6.4 Reescrita de textos de diferentes g√™neros e n√≠veis de formalidade"], "L√çNGUA INGLESA": ["1. Compreens√£o de textos variados: dom√≠nio do vocabul√°rio e da estrutura da l√≠ngua", "1.1 Ideias principais e secund√°rias, expl√≠citas e impl√≠citas", "1.2 Rela√ß√µes intratextuais e intertextuais", "2. Itens gramaticais relevantes para compreens√£o de conte√∫dos sem√¢nticos", "3. Conhecimento e uso das formas contempor√¢neas da linguagem inglesa"], "RACIOC√çNIO L√ìGICO E ANAL√çTICO": ["1. L√≥gica sentencial (ou proposicional)", "1.1 Proposi√ß√µes simples e compostas", "1.2 Tabelas-verdade", "1.3 Equival√™ncias", "2. Estrutura l√≥gica de rela√ß√µes arbitr√°rias entre pessoas, lugares, objetos ou eventos fict√≠cios", "2.1 Dedu√ß√£o de novas informa√ß√µes das rela√ß√µes fornecidas e avalia√ß√£o das condi√ß√µes usadas para estabelecer a estrutura daquelas rela√ß√µes", "3. Compreens√£o e an√°lise da l√≥gica de uma situa√ß√£o, utilizando as fun√ß√µes intelectuais", "3.1 Racioc√≠nio verbal e racioc√≠nio matem√°tico", "3.2 Racioc√≠nio sequencial e reconhecimento de padr√µes", "3.3 Orienta√ß√£o espacial e temporal", "3.4 Forma√ß√£o de conceitos e discrimina√ß√£o de elementos", "3.5 Compreens√£o de dados apresentados em gr√°ficos e tabelas", "4. Problemas de l√≥gica e racioc√≠nio", "4.1 Problemas de contagem e no√ß√µes de probabilidade", "5. Fal√°cias", "6. No√ß√µes de estat√≠stica: m√©dia, moda, mediana e desvio padr√£o"], "DIREITO ADMINISTRATIVO": ["1. No√ß√µes de organiza√ß√£o administrativa", "1.1 Centraliza√ß√£o, descentraliza√ß√£o, concentra√ß√£o e desconcentra√ß√£o", "1.2 Administra√ß√£o direta, indireta e funcional", "1.3 Autarquias, funda√ß√µes, empresas p√∫blicas e sociedades de economia mista", "2. Ato administrativo", "2.1 Conceito, requisitos, atributos, classifica√ß√£o e esp√©cies, extin√ß√£o, nulidades e revoga√ß√£o", "3. Agentes p√∫blicos", "3.1 Legisla√ß√£o pertinente e disposi√ß√µes constitucionais aplic√°veis", "3.2 Disposi√ß√µes doutrin√°rias: conceito e esp√©cies", "3.3 Cargo, emprego e fun√ß√£o p√∫blica", "3.4 Requisi√ß√£o", "3.5 Regime jur√≠dico dos servidores p√∫blicos federais: admiss√£o, demiss√£o, concurso p√∫blico, est√°gio probat√≥rio, vencimento b√°sico, acumula√ß√£o, regime disciplinar, licen√ßa e seguridade social", "4. Poderes administrativos", "4.1 Discricion√°rio, hier√°rquico, disciplinar, regulamentar e de pol√≠cia", "4.2 Uso e abuso do poder", "5. Controle da administra√ß√£o p√∫blica", "5.1 Controle exercido pela administra√ß√£o p√∫blica", "5.2 Controle judicial", "5.3 Controle legislativo", "6. Responsabilidade civil do Estado", "6.1 Responsabilidade civil do Estado no direito brasileiro", "6.1.1 Responsabilidade por ato comissivo do Estado", "6.1.2 Responsabilidade por omiss√£o do Estado", "6.2 Requisitos para a demonstra√ß√£o da responsabilidade do Estado", "6.3 Causas excludentes e atenuantes da responsabilidade do Estado", "7. Improbidade Administrativa (Lei n¬∫ 8.429/1992)", "8. Lei de Acesso √† Informa√ß√£o (Lei n¬∫ 12.527/2011)", "9. Lei Geral de Prote√ß√£o de Dados (Lei n¬∫ 13.709/2018)", "10. Processo Administrativo Federal (Lei n¬∫ 9.784/1999)"], "ADMINISTRA√á√ÉO P√öBLICA": ["1. Administra√ß√£o p√∫blica: do modelo racional-legal ao paradigma p√≥s-burocr√°tico", "1.1 Estado olig√°rquico e patrimonial, Estado autorit√°rio e burocr√°tico, Estado do bem-estar, Estado regulador", "2. Transpar√™ncia da administra√ß√£o p√∫blica", "2.1 Controle social e cidadania", "2.2 Accountability", "3. Excel√™ncia nos servi√ßos p√∫blicos", "3.1 Gest√£o por resultados na produ√ß√£o de servi√ßos p√∫blicos", "3.2 Gest√£o por compet√™ncias", "4. Comunica√ß√£o na gest√£o p√∫blica e gest√£o de redes organizacionais", "5. Princ√≠pios de governan√ßa p√∫blica", "6. Governabilidade e governan√ßa", "7. Intermedia√ß√£o de interesses (clientelismo, corporativismo e neocorporativismo)", "8. Pol√≠ticas p√∫blicas", "8.1 O ciclo das pol√≠ticas p√∫blicas: constru√ß√£o de agenda, formula√ß√£o da pol√≠tica e processo decis√≥rio", "8.2 Pol√≠ticas p√∫blicas no Estado brasileiro contempor√¢neo", "8.2.1 Descentraliza√ß√£o e democracia", "8.2.2 Participa√ß√£o, atores sociais e controle social", "8.2.3 Gest√£o local, cidadania e equidade social", "8.2.4 Corrup√ß√£o e pol√≠ticas p√∫blicas: fatores que influenciam a incid√™ncia de corrup√ß√£o e fatores que promovem a qualidade das pol√≠ticas p√∫blicas", "9. Reformas administrativas e redefini√ß√£o do papel do Estado; reforma do servi√ßo civil (m√©rito, flexibilidade e responsabiliza√ß√£o) e reforma do aparelho do Estado", "10. Mudan√ßas institucionais: conselhos, organiza√ß√µes sociais (OS), organiza√ß√£o da sociedade civil de interesse p√∫blico (OSCIP), ag√™ncia reguladora, ag√™ncia executiva, cons√≥rcios p√∫blicos"], "REGIMENTO INTERNO E C√ìDIGO DE √âTICA": ["1. Regimento Interno da C√¢mara dos Deputados", "1.1 Resolu√ß√£o n¬∫ 17/1989 ‚Äì CD, e altera√ß√µes", "2. Regimento Comum do Congresso Nacional", "2.1 Resolu√ß√£o n¬∫ 1/1970 ‚Äì CN, e altera√ß√µes (arts. 1¬∫ a 71 e 134 a 140)", "2.2 Resolu√ß√£o n¬∫ 3/1990 ‚Äì CN", "2.3 Resolu√ß√£o n¬∫ 1/2002 ‚Äì CN", "3. C√≥digo de √âtica e Decoro Parlamentar da C√¢mara dos Deputados"], "DIREITO CONSTITUCIONAL E PROCESSO LEGISLATIVO": ["1. Constitui√ß√£o da Rep√∫blica Federativa do Brasil de 1988", "1.1 Conceito, classifica√ß√µes, princ√≠pios fundamentais, emendas constitucionais", "2. Direitos e garantias fundamentais", "2.1 Direitos e deveres individuais e coletivos, direitos sociais, nacionalidade, cidadania, direitos pol√≠ticos, partidos pol√≠ticos", "3. Organiza√ß√£o pol√≠tico-administrativa", "3.1 Uni√£o, estados, Distrito Federal e munic√≠pios", "4. Administra√ß√£o p√∫blica", "4.1 Disposi√ß√µes gerais, servidores p√∫blicos", "5. Poder Legislativo", "5.1 Congresso Nacional, C√¢mara dos Deputados, Senado Federal, deputados e senadores, atribui√ß√µes, compet√™ncias, reuni√µes e comiss√µes", "6. Poder Executivo", "6.1 Atribui√ß√µes do presidente da Rep√∫blica e dos ministros de Estado", "7. Poder Judici√°rio", "7.1 Disposi√ß√µes gerais", "7.2 √ìrg√£os do Poder Judici√°rio e compet√™ncias", "7.3 Conselho Nacional de Justi√ßa (CNJ): composi√ß√£o e compet√™ncia", "8. Fun√ß√µes essenciais √† Justi√ßa", "8.1 Minist√©rio P√∫blico, advocacia e defensoria p√∫blicas", "9. Defesa do Estado e das Institui√ß√µes Democr√°ticas", "10. Lei Complementar n¬∫ 95/1998", "11. Crimes de Responsabilidade e abuso de autoridade", "11.1 Lei n¬∫ 1.079/1950", "11.2 Lei n¬∫ 13.869/2019 (crimes de abuso de autoridade)", "12. Procedimento Legislativo", "12.1 Tipos de procedimento: ordin√°rio, abreviado, sum√°rio, sumar√≠ssimo, especial e concentrado", "12.2 Etapas e no√ß√µes b√°sicas: comiss√µes, pareceres, delibera√ß√£o, vota√ß√£o, san√ß√£o e veto", "13. Mat√©rias Legislativas", "13.1 Projeto de lei ordin√°ria, complementar e delegada", "13.2 Medida provis√≥ria", "13.3 Projeto de decreto legislativo e projeto de resolu√ß√£o", "13.4 Proposta de Emenda √† Constitui√ß√£o (PEC)", "13.5 Indica√ß√µes, pareceres, requerimentos e vetos", "13.6 Iniciativa Legislativa: Presid√™ncia da Rep√∫blica, Congresso Nacional, tribunais e cidad√£os", "14. Fiscaliza√ß√£o Cont√°bil, Financeira e Or√ßament√°ria", "15. Processo Legislativo Or√ßament√°rio", "15.1 Plano Plurianual (PPA)", "15.2 Lei de Diretrizes Or√ßament√°rias (LDO)", "15.3 Lei Or√ßament√°ria Anual (LOA)", "15.4 As interfaces entre LDO, LOA, Lei n¬∫ 4.320/1964 e Lei Complementar n¬∫ 101/2000 (Lei de Responsabilidade Fiscal)", "15.5 Elabora√ß√£o e aprova√ß√£o das leis de mat√©ria or√ßament√°ria", "15.6 Proposta or√ßament√°ria e sua integra√ß√£o com PPA e LDO", "15.7 Execu√ß√£o financeira e cr√©ditos", "16. Conceito e instrumentos de execu√ß√£o financeira"], "CI√äNCIA POL√çTICA": ["1. Ci√™ncia Pol√≠tica", "2. Teoria pol√≠tica", "3. Regimes pol√≠ticos", "4. Sistemas e formas de governo", "5. Representa√ß√£o pol√≠tica", "6. Poderes e rela√ß√µes entre poderes: Executivo, Legislativo e Judici√°rio", "7. Sistemas eleitorais", "8. Teoria dos partidos pol√≠ticos", "9. Organiza√ß√£o pol√≠tica brasileira", "10. Pol√≠tica internacional contempor√¢nea", "11. Teoria do Estado e forma√ß√£o dos Estados nacionais", "12. Forma√ß√£o do Estado brasileiro", "13. Hist√≥ria do voto e dos partidos no Brasil"], "GOVERNAN√áA, ESTRAT√âGIA E GEST√ÉO": ["1. Governan√ßa", "1.1 Hist√≥rico da governan√ßa corporativa (prim√≥rdios e grandes marcos no mundo)", "1.2 Conceito de governan√ßa corporativa", "1.3 Princ√≠pios da governan√ßa corporativa: Responsabilidade, transpar√™ncia, equidade e Accountability", "1.4 Teorias de governan√ßa corporativa: teoria da ag√™ncia e teoria dos stakeholders", "1.5 Abordagem comportamental na governan√ßa", "1.6 Governan√ßa e √°reas de controle: controles internos, auditoria e compliance", "1.7 Gest√£o de riscos e integridade", "2. Estrat√©gia", "2.1 Conceito", "2.2 Fundamentos de estrat√©gia", "2.3 Condi√ß√µes necess√°rias para se desenvolver a estrat√©gia", "2.4 Quest√µes-chave em estrat√©gia", "3. Planejamento estrat√©gico", "3.1 Conceitos, m√©todos e t√©cnicas", "3.2 Modelos de gest√£o e estruturas organizacionais", "3.3 Planejamento institucional", "3.4 Escolas de planejamento estrat√©gico", "3.5 Ferramentas de planejamento estrat√©gico", "3.5.1 An√°lise SWOT", "3.5.2 Balanced Scorecard (BSC): principais conceitos, aplica√ß√µes, mapa estrat√©gico, perspectivas, temas estrat√©gicos, objetivos estrat√©gicos, rela√ß√µes de causa e efeito, indicadores, metas, iniciativas estrat√©gicas", "3.5.3 Indicadores e sistema de medi√ß√£o de desempenho organizacional", "3.5.3.1 Tipos de indicadores", "3.5.3.2 Vari√°veis componentes dos indicadores", "4. Gest√£o de Pessoas", "4.1 Comportamento organizacional: rela√ß√µes indiv√≠duo/organiza√ß√£o, motiva√ß√£o, desempenho, engajamento, trabalho em equipe e colabora√ß√£o", "4.2 Clima e cultura organizacional, sa√∫de mental e bem-estar", "4.3 Desenvolvimento e treinamento de pessoal: levantamento de necessidades, programa√ß√£o, execu√ß√£o e avalia√ß√£o", "4.4 Gest√£o por compet√™ncias: abordagens e ferramentas, mapeamento e desenvolvimento das compet√™ncias", "4.5 Desenvolvimento de pessoas como estrat√©gia de gest√£o e a intera√ß√£o dessa atividade com as demais fun√ß√µes do processo de gest√£o de pessoas", "4.6 Lideran√ßa: natureza e estilos de lideran√ßa", "5. Gest√£o por resultados na produ√ß√£o de servi√ßos p√∫blicos", "5.1 M√©tricas de aferi√ß√£o de resultados", "5.2 Trabalho h√≠brido", "6. Gerenciamento de conflitos", "7. Gest√£o da mudan√ßa", "8. Gest√£o de Projetos", "8.1 Ciclo de vida e organiza√ß√£o do projeto", "8.2 Processos de gerenciamento de projetos", "8.3 √Åreas de conhecimento em gerenciamento de projeto", "8.4 Ferramentas e t√©cnicas de apoio ao gerenciamento de projetos", "8.4.1 PMBOK 7¬™ edi√ß√£o", "8.5 Escrit√≥rio de projetos (PMO)", "8.6 Conceitos de gest√£o de programas e de gest√£o de portf√≥lio de projetos", "9. Gest√£o de Processos", "9.1 Gerenciamento de processos de neg√≥cio (BPM CBOK v.4.0)", "9.2 Conceitos, modelagem de processos, an√°lise de processos, desenho de processos, gerenciamento de desempenho de processos, transforma√ß√£o de processos, tecnologias de BPM", "9.3 Tipologia dos processos", "9.4 Hierarquia do processo: macroprocesso, processo, subprocesso, atividades e tarefa", "9.5 Reengenharia de processos", "9.6 Abordagens de melhoria de processos", "9.7 Nota√ß√£o BPMN", "9.8 Escrit√≥rio de processos: conceitos e atua√ß√£o"], "NO√á√ïES DE TECNOLOGIA DA INFORMA√á√ÉO E DADOS": ["1. Conceitos b√°sicos de hardware e software", "1.1 Funcionamento do computador", "1.2 Conhecimentos dos componentes", "2. No√ß√µes de sistema operacional (ambiente Windows 10 e 11) e MS Office M365 (Word, Excel, PowerPoint, OneDrive, SharePoint e Teams)", "3. Redes de computadores", "3.1 Conceitos b√°sicos, ferramentas, aplicativos e procedimentos de Internet e intranet", "3.2 Programas de navega√ß√£o (Microsoft Edge, Mozilla Firefox, Google Chrome e similares)", "3.3 Ferramentas de comunica√ß√£o e colabora√ß√£o: correio eletr√¥nico (webmail, cliente de e-mail), aplicativos de comunica√ß√£o (Microsoft Teams, Google Meet)", "3.4 Redes sociais", "3.5 Computa√ß√£o na nuvem (cloud computing)", "4. Conceitos gerais de seguran√ßa e governan√ßa digital", "4.1 Seguran√ßa da informa√ß√£o: procedimentos de c√≥pia de seguran√ßa (backup), no√ß√µes de v√≠rus, worms e pragas virtuais", "4.2 Programas de prote√ß√£o (antiv√≠rus, firewall, anti-spyware)", "4.3 Amea√ßas digitais (phishing, pharming)", "5. Tecnologias emergentes no setor p√∫blico", "5.1 Conceitos b√°sicos de intelig√™ncia artificial", "5.2 T√©cnicas de prompts", "6. √âtica e responsabilidade digital no servi√ßo p√∫blico", "7. Ci√™ncia de Dados", "7.1 Defini√ß√£o", "7.2 Import√¢ncia", "7.3 Aplica√ß√µes", "8. Dados", "8.1 Conceitos, atributos, m√©tricas, transforma√ß√£o de dados", "9. Governan√ßa da informa√ß√£o"]};
const DATAS = {"consulta_local_prova": "2026-02-23", "aplicacao_provas": "2026-03-08", "gabaritos_preliminares": "2026-03-13", "resultado_final_objetivas": "2026-04-08", "resultado_caracterizacao_deficiencia": "2026-04-24", "resultado_autodeclaracao": "2026-05-13", "resultado_final_procedimentos": "2026-05-26"};

let state = {
    user: null,
    targetDate: CONFIG.DATA_PROVA,
    progress: { kathiaja: {}, bruno: {} },
    links: {},
    schedule: [],
    linkType: 'theory',
    topic: null
};

// Utils
async function sha256(msg) {
    const buf = new TextEncoder().encode(msg);
    const hash = await crypto.subtle.digest('SHA-256', buf);
    return Array.from(new Uint8Array(hash)).map(b => b.toString(16).padStart(2, '0')).join('');
}

function formatDate(d) {
    const date = new Date(d + 'T12:00:00');
    const days = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'S√°b'];
    return `${days[date.getDay()]} ${String(date.getDate()).padStart(2, '0')}/${String(date.getMonth() + 1).padStart(2, '0')}`;
}

function daysBetween(d1, d2) {
    return Math.ceil((new Date(d2 + 'T12:00:00') - new Date(d1 + 'T12:00:00')) / 86400000);
}

function today() {
    const now = new Date();
    const offset = -3 * 60;
    const brasilia = new Date(now.getTime() + (now.getTimezoneOffset() + offset) * 60000);
    return brasilia.toISOString().split('T')[0];
}

function toast(msg, type = 'success') {
    const el = document.createElement('div');
    el.className = `toast ${type}`;
    el.innerHTML = `<i class="ri-${type === 'success' ? 'check' : 'error-warning'}-line"></i><span>${msg}</span>`;
    document.getElementById('toastContainer').appendChild(el);
    setTimeout(() => el.remove(), 3500);
}

function loading(show) {
    document.getElementById('loadingOverlay').classList.toggle('hidden', !show);
}

// Auth
document.getElementById('loginForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const user = document.getElementById('username').value.toLowerCase().trim();
    const pass = document.getElementById('password').value;
    
    if (!CONFIG.USUARIOS[user]) {
        document.getElementById('loginError').style.display = 'block';
        return;
    }
    
    const hash = await sha256(pass);
    if (hash === CONFIG.USUARIOS[user].senha_hash) {
        state.user = user;
        localStorage.setItem('user', user);
        document.getElementById('loginError').style.display = 'none';
        initApp();
    } else {
        document.getElementById('loginError').style.display = 'block';
    }
});

function logout() {
    state.user = null;
    localStorage.removeItem('user');
    document.getElementById('appContainer').classList.remove('active');
    document.getElementById('loginScreen').style.display = 'flex';
    document.getElementById('username').value = '';
    document.getElementById('password').value = '';
}

// Data
function loadData() {
    ['progress', 'links', 'schedule'].forEach(k => {
        const saved = localStorage.getItem(k);
        if (saved) state[k] = JSON.parse(saved);
    });
    if (!state.schedule.length) generateSchedule();
}

function saveData() {
    ['progress', 'links', 'schedule'].forEach(k => localStorage.setItem(k, JSON.stringify(state[k])));
}

function generateSchedule() {
    const t = today();
    const days = daysBetween(t, state.targetDate);
    if (days <= 0) { toast('Data limite inv√°lida!', 'error'); return; }
    
    const pending = [];
    Object.entries(CONTEUDO).forEach(([disc, topics]) => {
        topics.forEach(topic => {
            const key = `${disc}|${topic}`;
            const p = state.progress[state.user]?.[key];
            if (!p || !p.theory || !p.practice) pending.push({ disc, topic, key });
        });
    });
    
    // Intercalar disciplinas
    const byDisc = {};
    pending.forEach(t => {
        if (!byDisc[t.disc]) byDisc[t.disc] = [];
        byDisc[t.disc].push(t);
    });
    
    const shuffled = [];
    const discs = Object.keys(byDisc);
    const max = Math.max(...Object.values(byDisc).map(a => a.length));
    for (let i = 0; i < max; i++) {
        discs.forEach(d => { if (byDisc[d][i]) shuffled.push(byDisc[d][i]); });
    }
    
    const perDay = Math.ceil(shuffled.length / days);
    state.schedule = [];
    let date = new Date(t + 'T12:00:00');
    let idx = 0;
    
    while (idx < shuffled.length) {
        state.schedule.push({
            date: date.toISOString().split('T')[0],
            topics: shuffled.slice(idx, idx + perDay)
        });
        idx += perDay;
        date.setDate(date.getDate() + 1);
    }
    saveData();
}

// Render
function renderDisciplines() {
    const grid = document.getElementById('disciplinesGrid');
    grid.innerHTML = '';
    
    Object.entries(CONTEUDO).forEach(([disc, topics]) => {
        let kDone = 0, bDone = 0;
        topics.forEach(t => {
            const key = `${disc}|${t}`;
            if (state.progress.kathiaja[key]?.theory && state.progress.kathiaja[key]?.practice) kDone++;
            if (state.progress.bruno[key]?.theory && state.progress.bruno[key]?.practice) bDone++;
        });
        
        const kPct = Math.round((kDone / topics.length) * 100);
        const bPct = Math.round((bDone / topics.length) * 100);
        
        const card = document.createElement('div');
        card.className = 'discipline-card';
        card.innerHTML = `
            <div class="discipline-header" onclick="this.nextElementSibling.nextElementSibling.classList.toggle('expanded')">
                <h3>${disc}</h3>
                <span class="count">${topics.length} mat√©rias</span>
            </div>
            <div class="progress-bars">
                <div class="progress-item">
                    <div class="label"><span class="name kathiaja">Kathiaja</span><span>${kPct}%</span></div>
                    <div class="progress-bar"><div class="progress-fill kathiaja" style="width:${kPct}%"></div></div>
                </div>
                <div class="progress-item">
                    <div class="label"><span class="name bruno">Bruno</span><span>${bPct}%</span></div>
                    <div class="progress-bar"><div class="progress-fill bruno" style="width:${bPct}%"></div></div>
                </div>
            </div>
            <div class="discipline-content">
                ${topics.map(t => {
                    const key = `${disc}|${t}`;
                    const kP = state.progress.kathiaja[key] || {};
                    const bP = state.progress.bruno[key] || {};
                    const isCur = u => u === state.user;
                    const kComplete = kP.theory && kP.practice;
                    const bComplete = bP.theory && bP.practice;
                    return `
                        <div class="topic-item">
                            <div class="topic-checkboxes">
                                <div class="checkbox-row">
                                    <input type="checkbox" ${kComplete ? 'checked' : ''} ${!isCur('kathiaja') ? 'disabled' : ''} 
                                        onchange="toggleComplete('${disc.replace(/'/g,"\\'")}',' ${t.replace(/'/g,"\\'")}',' kathiaja', this.checked)">
                                    <span class="user-initial kathiaja">K</span>
                                </div>
                                <div class="checkbox-row">
                                    <input type="checkbox" ${bComplete ? 'checked' : ''} ${!isCur('bruno') ? 'disabled' : ''}
                                        onchange="toggleComplete('${disc.replace(/'/g,"\\'")}',' ${t.replace(/'/g,"\\'")}',' bruno', this.checked)">
                                    <span class="user-initial bruno">B</span>
                                </div>
                            </div>
                            <div class="topic-info" onclick="openModal('${disc.replace(/'/g,"\\'")}','${t.replace(/'/g,"\\'")}')">
                                <div class="topic-title">${t}</div>
                                <div class="topic-status">
                                    <span class="status-badge ${kP.theory ? 'done' : 'pending'}">üìñ ${kP.theory ? '‚úì' : '‚óã'}</span>
                                    <span class="status-badge ${kP.practice ? 'done' : 'pending'}">‚úèÔ∏è ${kP.practice ? '‚úì' : '‚óã'}</span>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('')}
            </div>
        `;
        grid.appendChild(card);
    });
}

function renderTimeline() {
    const tl = document.getElementById('timeline');
    tl.innerHTML = '';
    const t = today();
    
    state.schedule.forEach(day => {
        const isToday = day.date === t;
        const isPast = day.date < t;
        const el = document.createElement('div');
        el.className = `timeline-day ${isToday ? 'today' : ''} ${isPast ? 'past' : ''}`;
        el.id = `day-${day.date}`;
        el.innerHTML = `
            <div class="timeline-day-header">${formatDate(day.date)}</div>
            <div class="timeline-day-content">
                ${day.topics.map(t => {
                    const p = state.progress[state.user]?.[t.key];
                    const done = p?.theory && p?.practice;
                    return `
                        <div class="timeline-topic ${done ? 'completed' : ''}" onclick="openModal('${t.disc.replace(/'/g,"\\'")}','${t.topic.replace(/'/g,"\\'")}')">
                            <div class="discipline">${t.disc.substring(0, 18)}${t.disc.length > 18 ? '...' : ''}</div>
                            <div class="title">${t.topic.substring(0, 35)}${t.topic.length > 35 ? '...' : ''}</div>
                        </div>
                    `;
                }).join('')}
            </div>
        `;
        tl.appendChild(el);
    });
}

function renderEvents() {
    const grid = document.getElementById('eventsGrid');
    const t = today();
    const events = [
        { d: DATAS.consulta_local_prova, title: 'üìç Consulta aos Locais de Prova', desc: 'Divulga√ß√£o do edital' },
        { d: DATAS.aplicacao_provas, title: 'üìù Aplica√ß√£o das Provas', desc: 'Provas objetivas e discursiva' },
        { d: DATAS.gabaritos_preliminares, title: 'üìã Gabaritos Preliminares', desc: 'Divulga√ß√£o dos gabaritos' },
        { d: DATAS.resultado_final_objetivas, title: '‚úÖ Resultado Final Objetivas', desc: 'Resultado provas objetivas' },
        { d: DATAS.resultado_caracterizacao_deficiencia, title: '‚ôø Procedimentos Especiais', desc: 'Convoca√ß√£o para procedimentos' },
        { d: DATAS.resultado_autodeclaracao, title: 'üîç Verifica√ß√£o Autodeclara√ß√£o', desc: 'Resultado provis√≥rio' },
        { d: DATAS.resultado_final_procedimentos, title: 'üèÅ Resultado Final', desc: 'Resultado final e discursiva' }
    ];
    
    const months = ['Jan','Fev','Mar','Abr','Mai','Jun','Jul','Ago','Set','Out','Nov','Dez'];
    
    grid.innerHTML = events.map(e => {
        const isPast = e.d < t;
        const days = daysBetween(t, e.d);
        const isSoon = days >= 0 && days <= 7;
        return `
            <div class="event-card ${isPast ? 'past' : ''} ${isSoon ? 'soon' : ''}">
                <div class="event-date">
                    <div class="day">${e.d.split('-')[2]}</div>
                    <div class="month">${months[parseInt(e.d.split('-')[1]) - 1]}</div>
                </div>
                <div class="event-info">
                    <div class="title">${e.title}</div>
                    <div class="desc">${e.desc}</div>
                </div>
                <div class="event-countdown ${isPast ? 'passed' : isSoon ? 'soon' : 'normal'}">
                    ${isPast ? 'Conclu√≠do' : days === 0 ? 'üî• HOJE!' : `${days} dias`}
                </div>
            </div>
        `;
    }).join('');
}

function updateStats() {
    let total = 0;
    Object.values(CONTEUDO).forEach(t => total += t.length);
    document.getElementById('totalTopics').textContent = total;
    document.getElementById('totalDisciplines').textContent = Object.keys(CONTEUDO).length;
    
    let userDone = 0, partnerDone = 0;
    const partner = state.user === 'kathiaja' ? 'bruno' : 'kathiaja';
    
    Object.entries(CONTEUDO).forEach(([d, topics]) => {
        topics.forEach(t => {
            const key = `${d}|${t}`;
            if (state.progress[state.user]?.[key]?.theory && state.progress[state.user]?.[key]?.practice) userDone++;
            if (state.progress[partner]?.[key]?.theory && state.progress[partner]?.[key]?.practice) partnerDone++;
        });
    });
    
    document.getElementById('userProgress').textContent = userDone;
    document.getElementById('partnerProgress').textContent = partnerDone;
    
    const days = daysBetween(today(), state.targetDate);
    const remaining = total - userDone;
    document.getElementById('dailyGoal').textContent = days > 0 ? Math.ceil(remaining / days) : remaining;
    document.getElementById('daysRemaining').textContent = Math.max(0, days);
}

// Actions
function toggleComplete(disc, topic, user, done) {
    if (user !== state.user) return;
    const key = `${disc}|${topic}`;
    if (!state.progress[user]) state.progress[user] = {};
    state.progress[user][key] = { theory: done, practice: done };
    saveData();
    renderDisciplines();
    updateStats();
    toast(done ? 'Mat√©ria conclu√≠da! üéâ' : 'Mat√©ria desmarcada');
}

function openModal(disc, topic) {
    state.topic = { disc, topic };
    const key = `${disc}|${topic}`;
    document.getElementById('modalTitle').textContent = topic;
    document.getElementById('modalDiscipline').textContent = disc;
    const p = state.progress[state.user]?.[key] || {};
    document.getElementById('modalTheory').checked = p.theory || false;
    document.getElementById('modalPractice').checked = p.practice || false;
    renderLinks();
    document.getElementById('topicModal').classList.add('active');
}

function closeModal() {
    document.getElementById('topicModal').classList.remove('active');
    state.topic = null;
}

function switchLinksTab(type) {
    state.linkType = type;
    document.querySelectorAll('.links-tab').forEach(t => t.classList.toggle('active', t.dataset.type === type));
    renderLinks();
}

function renderLinks() {
    if (!state.topic) return;
    const key = `${state.topic.disc}|${state.topic.topic}`;
    const links = state.links[key]?.[state.linkType] || [];
    const list = document.getElementById('linksList');
    list.innerHTML = links.length === 0 
        ? '<div class="no-links">Nenhum link adicionado ainda</div>'
        : links.map((l, i) => `
            <div class="link-item">
                <i class="ri-link"></i>
                <a href="${l.url}" target="_blank">${l.url}</a>
                <span class="by">por ${l.by}</span>
                ${l.by === state.user ? `<i class="ri-delete-bin-line delete" onclick="deleteLink(${i})"></i>` : ''}
            </div>
        `).join('');
}

function addLink() {
    const url = document.getElementById('newLinkUrl').value.trim();
    if (!url || !state.topic) return;
    const key = `${state.topic.disc}|${state.topic.topic}`;
    if (!state.links[key]) state.links[key] = { theory: [], practice: [] };
    state.links[key][state.linkType].push({ url, by: state.user });
    document.getElementById('newLinkUrl').value = '';
    saveData();
    renderLinks();
    toast('Link adicionado!');
}

function deleteLink(i) {
    if (!state.topic) return;
    const key = `${state.topic.disc}|${state.topic.topic}`;
    state.links[key][state.linkType].splice(i, 1);
    saveData();
    renderLinks();
    toast('Link removido');
}

function updateTopicProgress() {
    if (!state.topic) return;
    const key = `${state.topic.disc}|${state.topic.topic}`;
    if (!state.progress[state.user]) state.progress[state.user] = {};
    state.progress[state.user][key] = {
        theory: document.getElementById('modalTheory').checked,
        practice: document.getElementById('modalPractice').checked
    };
}

function saveTopicChanges() {
    saveData();
    renderDisciplines();
    updateStats();
    closeModal();
    toast('Altera√ß√µes salvas!');
}

function switchTab(name) {
    document.querySelectorAll('.tab').forEach(t => t.classList.toggle('active', t.dataset.tab === name));
    document.getElementById('disciplinesTab').style.display = name === 'disciplines' ? 'block' : 'none';
    document.getElementById('timelineTab').style.display = name === 'timeline' ? 'block' : 'none';
    document.getElementById('eventsTab').style.display = name === 'events' ? 'block' : 'none';
    if (name === 'timeline') renderTimeline();
}

function scrollToToday() {
    const el = document.getElementById(`day-${today()}`);
    if (el) el.scrollIntoView({ behavior: 'smooth', inline: 'center' });
}

function updateTargetDate() {
    state.targetDate = document.getElementById('targetDate').value;
    localStorage.setItem('targetDate', state.targetDate);
    updateStats();
}

function redistributeStudies() {
    if (confirm('Reorganizar todo o cronograma de estudos?')) {
        generateSchedule();
        renderTimeline();
        updateStats();
        toast('Cronograma redistribu√≠do!');
    }
}

let searchTimer;
function handleSearch() {
    clearTimeout(searchTimer);
    const q = document.getElementById('searchInput').value.toLowerCase().trim();
    if (q.length < 2) { document.getElementById('searchResults').classList.remove('active'); return; }
    
    searchTimer = setTimeout(() => {
        const results = [];
        Object.entries(CONTEUDO).forEach(([d, topics]) => {
            if (d.toLowerCase().includes(q)) topics.forEach(t => results.push({ d, t }));
            else topics.forEach(t => { if (t.toLowerCase().includes(q)) results.push({ d, t }); });
        });
        
        const el = document.getElementById('searchResults');
        el.innerHTML = results.length === 0 
            ? '<div class="search-result-item">Nenhum resultado encontrado</div>'
            : results.slice(0, 8).map(r => `
                <div class="search-result-item" onclick="openModal('${r.d.replace(/'/g,"\\'")}','${r.t.replace(/'/g,"\\'")}'); document.getElementById('searchResults').classList.remove('active');">
                    <div class="discipline">${r.d}</div>
                    <div class="topic">${r.t}</div>
                </div>
            `).join('');
        el.classList.add('active');
    }, 400);
}

document.addEventListener('click', e => {
    if (!e.target.closest('.search-container')) document.getElementById('searchResults').classList.remove('active');
});

function reloadData() {
    loading(true);
    setTimeout(() => {
        loadData();
        renderDisciplines();
        updateStats();
        loading(false);
        toast('Dados atualizados!');
    }, 500);
}

async function initApp() {
    document.getElementById('loginScreen').style.display = 'none';
    document.getElementById('appContainer').classList.add('active');
    document.getElementById('currentUserName').textContent = CONFIG.USUARIOS[state.user].nome;
    
    const saved = localStorage.getItem('targetDate');
    state.targetDate = saved || CONFIG.DATA_PROVA;
    document.getElementById('targetDate').value = state.targetDate;
    document.getElementById('targetDate').max = CONFIG.DATA_PROVA;
    
    loadData();
    renderDisciplines();
    renderEvents();
    updateStats();
    loading(false);
}

window.addEventListener('DOMContentLoaded', () => {
    const saved = localStorage.getItem('user');
    if (saved && CONFIG.USUARIOS[saved]) {
        state.user = saved;
        initApp();
    } else {
        loading(false);
    }
});
    </script>
</body>
</html>